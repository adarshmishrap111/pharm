<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Track Order - Pharmida Healthcare</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .track-container {
            max-width: 900px;
            margin: 40px auto;
            padding: 30px;
        }
        .track-input-section {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }
        .track-input-section h2 {
            color: #206030;
            margin-bottom: 20px;
        }
        .input-group {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        .input-group input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        .input-group input:focus {
            outline: none;
            border-color: #4fd17c;
        }
        .btn-track {
            padding: 12px 30px;
            background: #4fd17c;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
        }
        .btn-track:hover {
            background: #219653;
        }
        .order-details {
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            display: none;
        }
        .order-details.active {
            display: block;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
            margin-bottom: 30px;
        }
        .order-id {
            font-size: 1.3em;
            color: #206030;
            font-weight: 700;
        }
        .order-status {
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        .status-pending {
            background: #fff4e6;
            color: #ff8800;
        }
        .status-confirmed {
            background: #e6f2ff;
            color: #0066cc;
        }
        .status-processing {
            background: #f0e6ff;
            color: #8800cc;
        }
        .status-shipped {
            background: #e6f7ff;
            color: #0088cc;
        }
        .status-out-for-delivery {
            background: #fff0e6;
            color: #ff6600;
        }
        .status-delivered {
            background: #e6ffe6;
            color: #00aa00;
        }
        .status-cancelled {
            background: #ffe6e6;
            color: #cc0000;
        }
        .tracking-timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 30px;
        }
        .timeline-item:last-child {
            padding-bottom: 0;
        }
        .timeline-dot {
            position: absolute;
            left: -40px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #ddd;
            border: 4px solid #fff;
            box-shadow: 0 0 0 2px #ddd;
        }
        .timeline-item.completed .timeline-dot {
            background: #4fd17c;
            box-shadow: 0 0 0 2px #4fd17c;
        }
        .timeline-item.active .timeline-dot {
            background: #2196f3;
            box-shadow: 0 0 0 2px #2196f3;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        .timeline-line {
            position: absolute;
            left: -31px;
            top: 20px;
            bottom: 0;
            width: 2px;
            background: #ddd;
        }
        .timeline-item.completed .timeline-line {
            background: #4fd17c;
        }
        .timeline-item:last-child .timeline-line {
            display: none;
        }
        .timeline-content {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
        }
        .timeline-title {
            font-weight: 700;
            color: #206030;
            margin-bottom: 5px;
        }
        .timeline-date {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        .timeline-desc {
            color: #444;
            font-size: 0.95em;
        }
        .order-items {
            margin-top: 30px;
        }
        .order-items h3 {
            color: #206030;
            margin-bottom: 15px;
        }
        .item-card {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: #f8f8f8;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .item-image {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 6px;
        }
        .item-info {
            flex: 1;
        }
        .item-name {
            font-weight: 600;
            color: #206030;
            margin-bottom: 5px;
        }
        .item-price {
            color: #666;
        }
        .error-message {
            background: #ffe6e6;
            border: 1px solid #ffcccc;
            color: #cc0000;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        .error-message.show {
            display: block;
        }
    </style>
</head>
<body>
    <nav class="main-navbar" style="width:100vw;background:#17613e;padding:0.5em 0;">
        <ul style="display:flex;justify-content:center;align-items:center;gap:32px;list-style:none;margin:0;padding:0;">
            <li><a href="index.html" style="color:#fff;font-weight:600;text-decoration:none;">Home</a></li>
            <li><a href="cart.html" style="color:#fff;font-weight:600;text-decoration:none;">Cart</a></li>
            <li><a href="track-order.html" style="color:#fff;font-weight:600;text-decoration:none;">Track Order</a></li>
        </ul>
    </nav>

    <div class="track-container">
        <div class="track-input-section">
            <h2>ðŸ“¦ Track Your Order</h2>
            <p style="color:#666;margin-bottom:20px;">Enter your order ID to track your delivery status</p>
            
            <div class="input-group">
                <input type="text" id="orderIdInput" placeholder="Enter Order ID (e.g., 1, 2, 3...)" />
                <button class="btn-track" onclick="trackOrder()">Track Order</button>
            </div>
            
            <div id="errorMessage" class="error-message"></div>
        </div>

        <div id="orderDetails" class="order-details">
            <div class="order-header">
                <div>
                    <div class="order-id">Order #<span id="displayOrderId"></span></div>
                    <div style="color:#666;margin-top:5px;">Placed on: <span id="orderDate"></span></div>
                </div>
                <div class="order-status" id="orderStatus"></div>
            </div>

            <div class="tracking-timeline" id="trackingTimeline"></div>

            <div class="order-items">
                <h3>Order Items</h3>
                <div id="orderItemsList"></div>
            </div>

            <div style="margin-top:30px;padding:20px;background:#f8fff8;border-radius:8px;border-left:4px solid #4fd17c;">
                <strong style="color:#206030;">Total Amount:</strong> 
                <span style="font-size:1.3em;color:#206030;font-weight:700;">â‚¹<span id="totalAmount">0</span></span>
            </div>
        </div>
    </div>

    <script>
        const trackingStages = [
            {
                id: 'pending',
                title: 'Order Placed',
                desc: 'Your order has been received and is being processed'
            },
            {
                id: 'confirmed',
                title: 'Order Confirmed',
                desc: 'Your order has been confirmed and payment received'
            },
            {
                id: 'processing',
                title: 'Processing',
                desc: 'We are preparing your order for shipment'
            },
            {
                id: 'shipped',
                title: 'Shipped',
                desc: 'Your order has been shipped and is on the way'
            },
            {
                id: 'out-for-delivery',
                title: 'Out for Delivery',
                desc: 'Your order is out for delivery and will arrive soon'
            },
            {
                id: 'delivered',
                title: 'Delivered',
                desc: 'Your order has been successfully delivered'
            }
        ];

        async function trackOrder() {
            const orderId = document.getElementById('orderIdInput').value.trim();
            const errorMsg = document.getElementById('errorMessage');
            const orderDetails = document.getElementById('orderDetails');

            errorMsg.classList.remove('show');
            orderDetails.classList.remove('active');

            if (!orderId) {
                showError('Please enter an order ID');
                return;
            }

            try {
                // For demo: Get from orders API (requires admin auth in real scenario)
                // In production, you'd have a public tracking endpoint
                const res = await fetch('/api/orders', {
                    credentials: 'same-origin'
                });
                
                if (!res.ok) {
                    // If not admin, try to get from localStorage (for demo)
                    showDemoOrder(orderId);
                    return;
                }

                const data = await res.json();
                const order = data.orders.find(o => String(o.id) === String(orderId));

                if (!order) {
                    showError('Order not found. Please check your order ID.');
                    return;
                }

                displayOrderDetails(order);
            } catch (err) {
                console.error(err);
                // Fallback to demo order
                showDemoOrder(orderId);
            }
        }

        function showDemoOrder(orderId) {
            // Demo order for testing
            const demoOrder = {
                id: orderId,
                total: 1234.50,
                items: JSON.stringify([
                    { name: 'Paracetamol 500mg', price: 50, image: 'https://via.placeholder.com/80' },
                    { name: 'Vitamin C Tablets', price: 250, image: 'https://via.placeholder.com/80' }
                ]),
                createdAt: new Date().toISOString(),
                status: 'shipped' // Change this to test different stages
            };
            displayOrderDetails(demoOrder);
        }

        function displayOrderDetails(order) {
            const orderDetails = document.getElementById('orderDetails');
            const items = JSON.parse(order.items || '[]');
            const status = order.status || 'pending';

            // Display order ID
            document.getElementById('displayOrderId').textContent = order.id;

            // Display date
            const date = new Date(order.createdAt);
            document.getElementById('orderDate').textContent = date.toLocaleDateString('en-IN', {
                day: 'numeric',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });

            // Display status badge
            const statusBadge = document.getElementById('orderStatus');
            statusBadge.textContent = formatStatus(status);
            statusBadge.className = 'order-status status-' + status;

            // Display timeline
            displayTimeline(status);

            // Display items
            const itemsList = document.getElementById('orderItemsList');
            itemsList.innerHTML = '';
            items.forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.className = 'item-card';
                itemCard.innerHTML = `
                    <img src="${item.image || 'https://via.placeholder.com/80'}" alt="${item.name}" class="item-image">
                    <div class="item-info">
                        <div class="item-name">${item.name}</div>
                        <div class="item-price">â‚¹${Number(item.price).toFixed(2)}</div>
                    </div>
                `;
                itemsList.appendChild(itemCard);
            });

            // Display total
            document.getElementById('totalAmount').textContent = Number(order.total).toFixed(2);

            // Show order details
            orderDetails.classList.add('active');
        }

        function displayTimeline(currentStatus) {
            const timeline = document.getElementById('trackingTimeline');
            timeline.innerHTML = '';

            const currentIndex = trackingStages.findIndex(s => s.id === currentStatus);

            trackingStages.forEach((stage, index) => {
                const item = document.createElement('div');
                item.className = 'timeline-item';
                
                if (index < currentIndex) {
                    item.classList.add('completed');
                } else if (index === currentIndex) {
                    item.classList.add('active');
                }

                const now = new Date();
                const stageDate = new Date(now.getTime() - (trackingStages.length - index - 1) * 24 * 60 * 60 * 1000);

                item.innerHTML = `
                    <div class="timeline-dot"></div>
                    <div class="timeline-line"></div>
                    <div class="timeline-content">
                        <div class="timeline-title">${stage.title}</div>
                        <div class="timeline-date">${index <= currentIndex ? stageDate.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' }) : 'Pending'}</div>
                        <div class="timeline-desc">${stage.desc}</div>
                    </div>
                `;

                timeline.appendChild(item);
            });
        }

        function formatStatus(status) {
            return status.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function showError(message) {
            const errorMsg = document.getElementById('errorMessage');
            errorMsg.textContent = message;
            errorMsg.classList.add('show');
        }

        // Auto-load if order ID in URL
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = urlParams.get('id');
            if (orderId) {
                document.getElementById('orderIdInput').value = orderId;
                trackOrder();
            }
        };
    </script>
</body>
</html>
