<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Prescription - Pharmida Healthcare</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="main-navbar" style="width:100vw;background:#17613e;padding:0.5em 0;">
        <ul style="display:flex;justify-content:center;align-items:center;gap:32px;list-style:none;margin:0;padding:0;">
            <li><a href="index.html" style="color:#fff;font-weight:600;text-decoration:none;">Home</a></li>
            <li><a href="cart.html" style="color:#fff;font-weight:600;text-decoration:none;">Cart</a></li>
            <li><a href="profile.html" style="color:#fff;font-weight:600;text-decoration:none;">Profile</a></li>
            <li><a href="upload-prescription.html" style="color:#fff;font-weight:600;text-decoration:none;">Upload Prescription</a></li>
            <li><a href="scan-prescription.html" style="color:#fff;font-weight:600;text-decoration:none;">Scan Prescription</a></li>
            <li><a href="call-ambulance.html" style="color:#fff;font-weight:600;text-decoration:none;">Call Ambulance</a></li>
            <li><a href="doctor-on-call.html" style="color:#fff;font-weight:600;text-decoration:none;">Doctor on Call</a></li>
            <li><a href="checkout.html" style="color:#fff;font-weight:600;text-decoration:none;">Checkout</a></li>
        </ul>
    </nav>
        <main style="max-width:700px;margin:40px auto;padding:20px;">
        <!-- Quick Navigation -->
        <div style="background:#f0f7ff;padding:16px;border-radius:8px;margin-bottom:24px;border-left:4px solid #4fd17c;">
            <h3 style="margin:0 0 8px 0;color:#4fd17c;">üì§ Prescription Upload Service</h3>
            <p style="margin:0;color:#666;">Upload your prescription safely and get your medicines delivered within 24 hours</p>
        </div>
        
        <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
            <button onclick="window.location='/scan-prescription.html'" style="background:#2196f3;color:#fff;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;">üì∑ Scan Prescription</button>
            <button onclick="window.location='/admin.html'" style="background:#667eea;color:#fff;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;">üë®‚Äçüíº Admin Panel</button>
        </div>

        <h2>Upload Prescription</h2>
        <div style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.1);">
            <div style="background:#e8f5e8;padding:16px;border-radius:8px;margin-bottom:20px;">
                <h4 style="margin:0 0 8px 0;color:#4fd17c;">‚úÖ What We Accept</h4>
                <ul style="margin:8px 0;padding-left:20px;color:#666;">
                    <li>üì± Photos: JPG, PNG (Mobile camera photos)</li>
                    <li>üìÑ Documents: PDF files</li>
                    <li>üìè Size limit: Maximum 5MB per file</li>
                    <li>üìã Clear, readable prescriptions only</li>
                </ul>
            </div>
            
            <form id="prescriptionForm" enctype="multipart/form-data">
                <label><strong>Choose Prescription File</strong></label><br>
                <input type="file" name="prescription" accept="image/*,application/pdf" required style="margin:10px 0 20px 0;padding:8px;border:1px solid #ddd;border-radius:6px;"><br>
                
                <label><strong>Additional Notes (Optional)</strong></label><br>
                <textarea name="notes" placeholder="Any special instructions, delivery preferences, or additional information..." style="width:100%;padding:12px;border-radius:6px;border:1px solid #ccc;margin-bottom:16px;" rows="4"></textarea><br>
                
                <button type="submit" id="uploadBtn" style="background:#4fd17c;color:#fff;padding:14px 28px;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:1.1em;">üì§ Upload Prescription</button>
                <span id="status" style="margin-left:12px;font-weight:600;"></span>
            </form>
            <div id="result" style="margin-top:20px;"></div>
        </div>
    </main>
    <script>
        document.getElementById('prescriptionForm').onsubmit = async function(e) {
            e.preventDefault();
            const status = document.getElementById('status');
            const btn = document.getElementById('uploadBtn');
            const result = document.getElementById('result');
            
            btn.disabled = true;
            btn.textContent = 'Uploading...';
            status.textContent = '';
            result.innerHTML = '';
            
            const fd = new FormData(e.target);
            const userId = localStorage.getItem('user_email') || 'guest';
            fd.append('userId', userId);
            
            try {
                const res = await fetch('/api/prescriptions', {
                    method: 'POST',
                    body: fd
                });
                const data = await res.json();
                
                if (res.ok) {
                    status.textContent = 'Uploaded successfully!';
                    status.style.color = '#00aa00';
                    result.innerHTML = `
                        <div style="background:#e6ffe6;padding:16px;border-radius:8px;margin-top:16px;">
                            <h3 style="margin:0 0 8px 0;color:#00aa00;">‚úì Prescription Uploaded</h3>
                            <p style="margin:0;">ID: ${data.prescription.id}</p>
                            <p style="margin:0;">Status: <strong>${data.prescription.status}</strong></p>
                            <p style="margin:4px 0 0 0;">We'll review your prescription and contact you soon.</p>
                        </div>
                    `;
                    e.target.reset();
                } else {
                    status.textContent = data.error || 'Upload failed';
                    status.style.color = '#ff0000';
                }
            } catch (err) {
                status.textContent = 'Network error';
                status.style.color = '#ff0000';
            } finally {
                btn.disabled = false;
                btn.textContent = 'Upload Prescription';
            }
        };
    </script>
</body>
</html>