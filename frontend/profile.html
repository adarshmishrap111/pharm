<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile - Pharmida Healthcare</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="main-navbar" style="width:100vw;background:#17613e;padding:0.5em 0;">
        <ul style="display:flex;justify-content:center;align-items:center;gap:32px;list-style:none;margin:0;padding:0;">
            <li><a href="index.html" style="color:#fff;font-weight:600;text-decoration:none;">Home</a></li>
            <li><a href="cart.html" style="color:#fff;font-weight:600;text-decoration:none;">Cart</a></li>
            <li><a href="profile.html" style="color:#fff;font-weight:600;text-decoration:none;">Profile</a></li>
            <li><a href="upload-prescription.html" style="color:#fff;font-weight:600;text-decoration:none;">Upload Prescription</a></li>
            <li><a href="scan-prescription.html" style="color:#fff;font-weight:600;text-decoration:none;">Scan Prescription</a></li>
            <li><a href="call-ambulance.html" style="color:#fff;font-weight:600;text-decoration:none;">Call Ambulance</a></li>
            <li><a href="doctor-on-call.html" style="color:#fff;font-weight:600;text-decoration:none;">Doctor on Call</a></li>
            <li><a href="product-upload.html" style="color:#fff;font-weight:600;text-decoration:none;">Product Upload</a></li>
            <li><a href="checkout.html" style="color:#fff;font-weight:600;text-decoration:none;">Checkout</a></li>
        </ul>
    </nav>
        <main style="max-width:600px;margin:40px auto;padding:20px;">
        <h2>Your Profile</h2>
        <form id="profileForm" style="background:#fff;padding:30px;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,0.1);">
            <label>Full Name</label><br>
            <input type="text" name="name" id="name" placeholder="Full Name" required style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;margin-bottom:16px;"><br>
            <label>Email</label><br>
            <input type="email" name="email" id="email" placeholder="Email" required style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;margin-bottom:16px;"><br>
            <label>Phone Number</label><br>
            <input type="tel" name="phone" id="phone" placeholder="Phone Number" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;margin-bottom:16px;"><br>
            <label>Address</label><br>
            <textarea name="address" id="address" placeholder="Full Address" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;margin-bottom:16px;" rows="3"></textarea><br>
            <button type="submit" style="background:#4fd17c;color:#fff;padding:12px 24px;border:none;border-radius:8px;font-weight:600;cursor:pointer;">Update Profile</button>
            <span id="status" style="margin-left:12px;font-weight:600;"></span>
        </form>
    </main>
    <script>
        // Load existing profile if available
        async function loadProfile() {
            const email = localStorage.getItem('user_email');
            if (!email) return;
            try {
                const res = await fetch('/api/profile/' + email);
                if (res.ok) {
                    const data = await res.json();
                    const p = data.profile;
                    document.getElementById('name').value = p.name || '';
                    document.getElementById('email').value = p.email || '';
                    document.getElementById('phone').value = p.phone || '';
                    document.getElementById('address').value = p.address || '';
                }
            } catch (err) { console.error(err); }
        }
        loadProfile();

        document.getElementById('profileForm').onsubmit = async function(e) {
            e.preventDefault();
            const status = document.getElementById('status');
            status.textContent = 'Saving...';
            status.style.color = '#206030';
            
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value
            };
            
            try {
                const res = await fetch('/api/profile', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                const data = await res.json();
                if (res.ok) {
                    localStorage.setItem('user_email', formData.email);
                    status.textContent = 'Profile saved successfully!';
                    status.style.color = '#00aa00';
                } else {
                    status.textContent = data.error || 'Error saving profile';
                    status.style.color = '#ff0000';
                }
            } catch (err) {
                status.textContent = 'Network error';
                status.style.color = '#ff0000';
            }
            setTimeout(() => status.textContent = '', 3000);
        };
    </script>
</body>
</html>